/*
 * WRScaler - v0.1.0-alpha - 2014-09-20
 * A jQuery plugin that applies a CSS3 scale transform to an element to resize it below a specified window breakpoint width.
 * https://github.com/wruth/wrscaler
 *
 * Copyright (c) 2014 Ward Ruth
 * Under MIT License
 */
!function(a){function b(){var a=window,b="inner";return"innerWidth"in window||(b="client",a=document.documentElement||document.body),{width:a[b+"Width"],height:a[b+"Height"]}}function c(b){var c=this.$el.css("transform"),f=this;this.baseTransform=c,this.matrix=e(c),this.$window=a(window),this.threshold=b.threshold,this.targetWidth=this.$el.outerWidth(),this.targetDelta=this.threshold-this.targetWidth,this.changeCallback=b.changeCallback,b.isVScaleParent&&(this.$parent=this.$el.parent(),this.parentBaseHeight=this.$parent.height()),this.resizeProxy=function(){g.call(f)},d.call(this,b.threshold)}function d(c){var d=b().width-a(window).width(),e=c-1+d,g="(max-width: "+e+"px)";this.mql=window.matchMedia(g),this.mqlListenerProxy=a.proxy(f,this),this.mql.addListener(this.mqlListenerProxy),this.isMqlMatched=!1,this.mqlListenerProxy(this.mql)}function e(a){if("none"===a)return["1","0","0","1","0","0"];var b=a.indexOf("(")+1,c=a.slice(b,-1),d=c.split(",");return d}function f(a){a.matches?(this.$window.on("resize"+i,this.resizeProxy),g.call(this,!this.isMqlMatched),this.isMqlMatched=!0):(this.$window.off("resize"+i,this.resizeProxy),h.call(this),this.changeCallback({type:"transform-end"}),this.isMqlMatched=!1)}function g(a){var b=this.$window.width(),c=b-this.targetDelta,d=c/this.targetWidth,e={type:a?"transform-start":"transform-change",scale:d,resizedTargetWidth:c,windowWidth:b},f="matrix(";this.matrix[0]=this.matrix[3]=d,f+=this.matrix.join(", ")+")",this.$el.css("transform",f),this.$parent&&this.$parent.height(this.parentBaseHeight*d),this.changeCallback(e)}function h(){var a="none"===this.baseTransform?"":this.baseTransform;this.$el.css("transform",a),this.$parent&&this.$parent.css("height","")}var i=".wrscaler";a.WRScaler=function(b,d){this.el=b,this.$el=a(b),c.call(this,d)},a.WRScaler.prototype.destroy=function(){this.mql.removeListener(this.mqlListenerProxy),this.$window.off("resize"+i,this.resizeProxy),h.call(this),this.$el.removeData("wrscaler")},a.fn.wrscaler=function(b){var c=a.extend({},a.fn.wrscaler.defaults,b||{});return window.matchMedia&&"undefined"!=typeof c.threshold?this.each(function(){var b=a(this);b.data("wrscaler")&&b.data("wrscaler").destroy(),b.data("wrscaler",new a.WRScaler(this,c))}):this},a.fn.wrscaler.defaults={changeCallback:function(){},isVScaleParent:!0}}(jQuery);